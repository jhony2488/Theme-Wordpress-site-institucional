(function(){"use strict";var t,d,u,l,c,f,o,v,b,p,e,_,g,n,r,h,i,s,y,m,A,k;function a(t){this.parser=t,this.cancelDragAdded=!1}(d=this).hatemile||(this.hatemile={}),(t=this.hatemile).implementation||(t.implementation={}),this.hatemile.implementation.AccessibleEventImplementation=(o="data-keypressed",f="data-keydownadded",v="data-keypressadded",b="data-keyupadded",c="data-focusadded",l="data-bluradded",u="click",_="hover",p="drag",e="drop",A=function(t){var e="\n".charCodeAt(0),a="\r".charCodeAt(0);return t===e||t===a},k=function(t){var e;t.hasAttribute("tabindex")||("A"===(e=t.getTagName())&&!t.hasAttribute("href")||"A"!==e&&"INPUT"!==e&&"BUTTON"!==e&&"SELECT"!==e&&"TEXTAREA"!==e)&&t.setAttribute("tabindex","0")},m=function(t,e,a,n){var r=t.getData();return void 0===a||void 0===n?r["on"+e]instanceof Function||void 0!==r.eventListenerList&&r.eventListenerList[e]instanceof Function:(r=t.getAttribute(a),m(t,e)&&!t.hasAttribute(a)||d.hatemile.util.CommonFunctions.inList(r,n))},g=function(t){for(var e,a,n,r,i=t.find("[aria-dropeffect]").listResults(),s=0,o=i.length;s<o;s++)n=i[s],a=!m(n,"keydown",f,p)&&!m(n,"keyup",b,p),e=!n.hasAttribute(v)&&!m(n,"keydown",f,u)&&!m(n,"keyup",b,u),r=!m(n,"focus",c,_)&&!m(n,"blur",l,_),n.setAttribute("aria-dropeffect","none"),n.hasAttribute("tabindex")&&a&&e&&r&&n.removeAttribute("tabindex")},y=function(t){for(var e,a=d.__dragEventDataTransfer__.dropEffect,n=d.__dragEventDataTransfer__.effectAllowed,r="none"===a||"copy"!==a&&"link"!==a&&"move"!==a?"copyLink"===n||"copyMove"===n||"linkMove"===n||"all"===n?"popup":"copy"===n||"move"===n||"link"===n?n:"move":a,i=t.find("[aria-dropeffect]").listResults(),s=0,o=i.length;s<o;s++)e=i[s],m(e,"drop")&&e.setAttribute("aria-dropeffect",r),k(e)},s=function(t,e,a){i(e,r(t,e,a))},h=function(t,e,a){void 0===d.__dragEventDataTransfer__&&(d.__dragEventDataTransfer__={files:null,types:null,effectAllowed:"uninitialized",dropEffect:"none"},d.__dragEventDataTransfer__.setDragImage=function(){},d.__dragEventDataTransfer__.addElement=function(){},d.__dragEventDataTransfer__._data={},d.__dragEventDataTransfer__.setData=function(t,e){d.__dragEventDataTransfer__._data[t]=e},d.__dragEventDataTransfer__.getData=function(t){return d.__dragEventDataTransfer__._data[t]},d.__dragEventDataTransfer__.clearData=function(t){void 0===t?d.__dragEventDataTransfer__._data={}:d.__dragEventDataTransfer__._data[t]=void 0}),i(e,n(t,e,a))},i=function(t,e){var a,n,r,i,s,o=t.getData();if(m(t,e.type)){if((a=o["on"+e.type])instanceof Function)try{a.call(o,e)}catch(t){0}if(void 0!==o.eventListenerList&&o.eventListenerList[e.type]instanceof Function)for(n=0,r=(s=o.eventListenerList[e.type]).length;n<r;n++){i=s[n];try{i.call(o,e)}catch(t){0}}}},r=function(t,e,a){e={type:t,view:a.view,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey,metaKey:a.metaKey,button:0,buttons:1,bubbles:!0,cancelable:!0,target:e.getData(),originalTarget:e.getData(),cancelBubble:!1,isTrusted:!0,detail:0,clientX:0,clientY:0,pageX:0,pageY:0,screenX:0,screenY:0,layerX:0,layerY:0,offsetX:0,offsetY:0,preventDefault:function(){return a.preventDefault()},stopImmediatePropagation:function(){return a.stopImmediatePropagation()},stopPropagation:function(){return a.stopPropagation()}};return e},n=function(t,e,a){a=r(t,e,a);return a.dataTransfer=d.__dragEventDataTransfer__,a},a.prototype._addEventHandler=function(t,r,e,a,n){var i,s,o;m(t,r,e,a)||(s=!1,i=t.getAttribute(e),o=t.getData(),m(t,r)?s=d.hatemile.util.CommonFunctions.inList(i,a):(o["liston"+r]=[],o["on"+r]=function(t){for(var e=o["liston"+r],a=0,n=e.length;a<n;a++)(0,e[a])(t)}),s||(o["liston"+r].push(n),i=d.hatemile.util.CommonFunctions.increaseInList(i,a),t.setAttribute(e,i)))},a.prototype._visit=function(t,e,a,n){var r,i,s,o;if(!t.hasAttribute("data-ignoreaccessibilityfix"))for(e(t)&&n.call(a,t),s=0,o=(i=t.getChildrenElements()).length;s<o;s++)r=i[s],this._visit(r,e,a,n)},a.prototype.makeAccessibleDropEvents=function(i){var s;i.setAttribute("aria-dropeffect","none"),s=this.parser,this._addEventHandler(i,"focus",c,e,function(t){null!==s.find('[aria-grabbed="true"]').firstResult()&&(h("dragenter",i,t),h("dragover",i,t),y(s))}),this._addEventHandler(i,"blur",l,e,function(t){null!==s.find('[aria-grabbed="true"]').firstResult()&&(h("dragleave",i,t),y(s))}),m(i,"keydown",f,e)||m(i,"keyup",b,e)||(this._addEventHandler(i,"keydown",f,e,function(t){var e,a,n,r;if(A(t.keyCode)&&!i.hasAttribute(o)&&null!==s.find("[aria-grabbed=true]").firstResult()){if(i.setAttribute(o,"true"),m(i,"drop")){for(n=0,r=(a=s.find('[aria-grabbed="true"]').listResults()).length;n<r;n++)(e=a[n]).setAttribute("aria-grabbed","false"),h("dragend",e,t);g(s)}h("drop",i,t)}}),this._addEventHandler(i,"keyup",b,e,function(t){i.removeAttribute(o)}))},a.prototype.makeAccessibleDragEvents=function(i){var s,t;k(i),i.setAttribute("aria-grabbed","false"),s=this.parser,m(i,"keydown",f,p)||m(i,"keyup",b,p)||(this._addEventHandler(i,"keydown",f,p,function(t){var e,a,n,r;if(t.keyCode===" ".charCodeAt(0)&&!i.hasAttribute(o)){for(n=0,r=(a=s.find('[aria-grabbed="true"]').listResults()).length;n<r;n++)(e=a[n]).setAttribute("aria-grabbed","false"),h("dragend",e,t);i.setAttribute("aria-grabbed","true"),i.setAttribute(o,"true"),h("dragstart",i,t),h("drag",i,t),y(s)}}),this._addEventHandler(i,"keyup",b,p,function(t){i.removeAttribute(o)})),this.cancelDragAdded||(t=this.parser.find("html").firstResult(),this._addEventHandler(t,"keypress",v,u,function(t){var e,a,n,r;if(27===t.keyCode){for(n=0,r=(a=s.find('[aria-grabbed="true"]').listResults()).length;n<r;n++)(e=a[n]).setAttribute("aria-grabbed","false"),h("dragend",e,t);g(s)}}),this.cancelDragAdded=!0)},a.prototype.makeAccessibleAllDragandDropEvents=function(){var t=this.parser.find("body").firstResult();this._visit(t,function(t){return m(t,"drag")||m(t,"dragstart")||m(t,"dragend")},this,this.makeAccessibleDragEvents),this._visit(t,function(t){return m(t,"drop")||m(t,"dragenter")||m(t,"dragleave")||m(t,"dragover")},this,this.makeAccessibleDropEvents)},a.prototype.makeAccessibleHoverEvents=function(e){k(e),this._addEventHandler(e,"focus",c,_,function(t){s("mouseover",e,t)}),this._addEventHandler(e,"blur",l,_,function(t){s("mouseout",e,t)})},a.prototype.makeAccessibleAllHoverEvents=function(){this._visit(this.parser.find("body").firstResult(),function(t){return m(t,"mouseover")||m(t,"mouseout")},this,this.makeAccessibleHoverEvents)},a.prototype.makeAccessibleClickEvents=function(e){var t,a;k(e),a=["submit","button","reset"],"INPUT"===(t=e.getTagName())&&e.hasAttribute("type")&&-1!==a.indexOf(e.getAttribute("type").toLowerCase())||"BUTTON"===t||"A"===t||this._addEventHandler(e,"keypress",v,u,function(t){A(t.keyCode)&&(m(e,"click")?s("click",e,t):m(e,"dblclick")&&s("dblclick",e,t))}),this._addEventHandler(e,"keyup",b,u,function(t){A(t.keyCode)&&s("mouseup",e,t)}),this._addEventHandler(e,"keydown",f,u,function(t){A(t.keyCode)&&s("mousedown",e,t)})},a.prototype.makeAccessibleAllClickEvents=function(){this._visit(this.parser.find("body").firstResult(),function(t){return m(t,"click")||m(t,"mousedown")||m(t,"mouseup")||m(t,"dblclick")},this,this.makeAccessibleClickEvents)},a)}).call(this);