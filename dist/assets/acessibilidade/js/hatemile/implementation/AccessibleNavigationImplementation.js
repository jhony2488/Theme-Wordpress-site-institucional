(function(){"use strict";var e,u,n,s,r,a,l,o,h,i;function t(e,t,i){this.parser=e,this.configure=t,this.skippers=i,this.idGenerator=new hatemile.util.IDGenerator("navigation"),this.attributeLongDescriptionPrefixBefore=this.configure.getParameter("attribute-longdescription-prefix-before"),this.attributeLongDescriptionSuffixBefore=this.configure.getParameter("attribute-longdescription-suffix-before"),this.attributeLongDescriptionPrefixAfter=this.configure.getParameter("attribute-longdescription-prefix-after"),this.attributeLongDescriptionSuffixAfter=this.configure.getParameter("attribute-longdescription-suffix-after"),this.elementsHeadingBefore=this.configure.getParameter("elements-heading-before"),this.elementsHeadingAfter=this.configure.getParameter("elements-heading-after"),this.listSkippersAdded=!1,this.listHeadingAdded=!1,this.validateHeading=!1,this.validHeading=!1,this.listSkippers=null,this.listHeadingBefore=null,this.listHeadingAfter=null}(u=this).hatemile||(this.hatemile={}),(e=this.hatemile).implementation||(e.implementation={}),this.hatemile.implementation.AccessibleNavigationImplementation=(i="container-skippers",h="container-heading-before",o="container-heading-after",r="text-heading",s="force-link-before",n="force-link-after",l="data-headinglevel",a="data-attributelongdescriptionof",t.prototype._generateListSkippers=function(){var e,t=this.parser.find("#"+i).firstResult();return null===t&&null!==(e=this.parser.find("body").firstResult())&&((t=this.parser.createElement("div")).setAttribute("id",i),e.prependElement(t)),(e=null)!==t&&null===(e=this.parser.find(t).findChildren("ul").firstResult())&&(e=this.parser.createElement("ul"),t.appendElement(e)),this.listSkippersAdded=!0,e},t.prototype._generateListHeading=function(){var e,t,i=this.parser.find("body").firstResult();null!==i&&(null===(e=this.parser.find("#"+h).firstResult())&&0<this.elementsHeadingBefore.length&&((e=this.parser.createElement("div")).setAttribute("id",h),(t=this.parser.createElement("span")).setAttribute("class",r),t.appendText(this.elementsHeadingBefore),e.appendElement(t),i.prependElement(e)),null!==e&&(this.listHeadingBefore=this.parser.find(e).findChildren("ol").firstResult(),null===this.listHeadingBefore&&(this.listHeadingBefore=this.parser.createElement("ol"),e.appendElement(this.listHeadingBefore))),null===(e=this.parser.find("#"+o).firstResult())&&0<this.elementsHeadingAfter.length&&((e=this.parser.createElement("div")).setAttribute("id",o),(t=this.parser.createElement("span")).setAttribute("class",r),t.appendText(this.elementsHeadingAfter),e.appendElement(t),i.appendElement(e)),null!==e&&(this.listHeadingAfter=this.parser.find(e).findChildren("ol").firstResult(),null===this.listHeadingAfter&&(this.listHeadingAfter=this.parser.createElement("ol"),e.appendElement(this.listHeadingAfter))),this.listHeadingAdded=!0)},t.prototype._getHeadingLevel=function(e){e=e.getTagName();return"H1"===e?1:"H2"===e?2:"H3"===e?3:"H4"===e?4:"H5"===e?5:"H6"===e?6:-1},t.prototype._isValidHeading=function(){var e,t,i,r,n,s;for(this.validateHeading=!0,i=e=r=0,n=(t=this.parser.find("h1,h2,h3,h4,h5,h6").listResults()).length;i<n;i++){if(s=t[i],1===(s=this._getHeadingLevel(s))){if(1===e)return!1;e=1}if(1<s-r)return!1;r=s}return!0},t.prototype._generateAnchorFor=function(e,t,i){var r;return this.idGenerator.generateId(e),(r=null)===this.parser.find("["+t+'="'+e.getAttribute("id")+'"]').firstResult()&&("A"===e.getTagName()?r=e:(r=this.parser.createElement("a"),this.idGenerator.generateId(r),r.setAttribute("class",i),e.insertBefore(r)),r.hasAttribute("name")||r.setAttribute("name",r.getAttribute("id")),r.setAttribute(t,e.getAttribute("id"))),r},t.prototype._freeShortcut=function(e){for(var t,i,r,n,s,a,l,o,h="1234567890abcdefghijklmnopqrstuvwxyz",d=this.parser.find("[accesskey]").listResults(),p=0,f=d.length;p<f;p++)if(o=(t=d[p]).getAttribute("accesskey").toLowerCase(),u.hatemile.util.CommonFunctions.inList(o,e)){for(r=0,a=h.length;r<a;r++){for(s=h[r],i=!0,n=0,l=d.length;n<l;n++)if(o=d[n].getAttribute("accesskey").toLowerCase(),u.hatemile.util.CommonFunctions.inList(o,s)){i=!1;break}if(i){t.setAttribute("accesskey",s);break}}if(i)break}},t.prototype.provideNavigationBySkipper=function(e){for(var t,i,r,n,s,a,l,o=null,h=this.skippers,d=0,p=h.length;d<p;d++){for(i=h[d],n=0,s=(t=this.parser.find(i.selector).listResults()).length;n<s;n++)if(t[n].equals(e)){o=i;break}if(null!==o)break}null!==o&&(this.listSkippersAdded||(this.listSkippers=this._generateListSkippers()),null!==this.listSkippers&&null!==(l=this._generateAnchorFor(e,"data-anchorfor","skipper-anchor"))&&(r=this.parser.createElement("li"),(a=this.parser.createElement("a")).setAttribute("href","#"+l.getAttribute("name")),a.appendText(this.configure.getParameter(o.description)),void 0!==(l=o.shortcut)&&0<l.length&&(l=l[0],this._freeShortcut(l),a.setAttribute("accesskey",l)),this.idGenerator.generateId(a),r.appendElement(a),this.listSkippers.appendElement(r)))},t.prototype.provideNavigationByAllSkippers=function(){for(var e,t,i,r,n,s=this.skippers,a=0,l=s.length;a<l;a++)for(n=s[a],i=0,r=(t=this.parser.find(n.selector).listResults()).length;i<r;i++)e=t[i],u.hatemile.util.CommonFunctions.isValidElement(e)&&this.provideNavigationBySkipper(e)},t.prototype.provideNavigationByHeading=function(e){var t,i,r,n,s,a;this.validateHeading||(this.validHeading=this._isValidHeading()),this.validHeading&&null!==(t=this._generateAnchorFor(e,"data-headinganchorfor","heading-anchor"))&&(this.listHeadingAdded||this._generateListHeading(),r=n=null,1===(i=this._getHeadingLevel(e))?(n=this.listHeadingBefore,r=this.listHeadingAfter):(s="["+l+'="'+(i-1).toString()+'"]',null!==this.listHeadingBefore&&null!==(a=this.parser.find(this.listHeadingBefore).findDescendants(s).lastResult())&&null===(n=this.parser.find(a).findChildren("ol").firstResult())&&(n=this.parser.createElement("ol"),a.appendElement(n)),null!==this.listHeadingAfter&&null!==(a=this.parser.find(this.listHeadingAfter).findDescendants(s).lastResult())&&null===(r=this.parser.find(a).findChildren("ol").firstResult())&&(r=this.parser.createElement("ol"),a.appendElement(r))),(a=this.parser.createElement("li")).setAttribute(l,i.toString()),(i=this.parser.createElement("a")).setAttribute("href","#"+t.getAttribute("name")),i.appendText(e.getTextContent()),a.appendElement(i),null!==n&&n.appendElement(a.cloneElement()),null!==r&&r.appendElement(a.cloneElement()))},t.prototype.provideNavigationByAllHeadings=function(){for(var e,t=this.parser.find("h1,h2,h3,h4,h5,h6").listResults(),i=0,r=t.length;i<r;i++)e=t[i],u.hatemile.util.CommonFunctions.isValidElement(e)&&this.provideNavigationByHeading(e)},t.prototype.provideNavigationToLongDescription=function(e){var t,i,r;e.hasAttribute("longdesc")&&e.hasAttribute("alt")&&(this.idGenerator.generateId(e),i=e.getAttribute("id"),null===this.parser.find("."+s+"["+a+'="'+i+'"]').firstResult()&&(0<this.attributeLongDescriptionPrefixBefore.length||0<this.attributeLongDescriptionSuffixBefore.length)&&(r=this.attributeLongDescriptionPrefixBefore+(""+e.getAttribute("alt"))+this.attributeLongDescriptionSuffixBefore,(t=this.parser.createElement("a")).setAttribute("href",e.getAttribute("longdesc")),t.setAttribute("target","_blank"),t.setAttribute(a,i),t.setAttribute("class",s),t.appendText(r),e.insertBefore(t)),null===this.parser.find("."+n+"["+a+'="'+i+'"]').firstResult()&&(0<this.attributeLongDescriptionPrefixAfter.length||0<this.attributeLongDescriptionSuffixAfter.length)&&(r=this.attributeLongDescriptionPrefixAfter+(""+e.getAttribute("alt"))+this.attributeLongDescriptionSuffixAfter,(t=this.parser.createElement("a")).setAttribute("href",e.getAttribute("longdesc")),t.setAttribute("target","_blank"),t.setAttribute(a,i),t.setAttribute("class",n),t.appendText(r),e.insertAfter(t)))},t.prototype.provideNavigationToAllLongDescriptions=function(){for(var e,t=this.parser.find("[longdesc]").listResults(),i=0,r=t.length;i<r;i++)e=t[i],u.hatemile.util.CommonFunctions.isValidElement(e)&&this.provideNavigationToLongDescription(e)},t)}).call(this);